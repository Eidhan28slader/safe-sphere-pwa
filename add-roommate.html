<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Roommate</title>
    <link rel="stylesheet" href="/safe-sphere-pwa/styles.css">
</head>

<body>

<nav>
    <img src="/safe-sphere-pwa/assets/logo.png" class="logo" alt="SafeSphere logo">
    <a href="/safe-sphere-pwa/index.html">Home</a>
    <a href="/safe-sphere-pwa/listing.html">Listing</a>
    <a href="/safe-sphere-pwa/post.html">Post</a>
    <a href="/safe-sphere-pwa/admin.html">Admin</a>
    <a href="/safe-sphere-pwa/roommates.html">Roommates</a>
    <a href="/safe-sphere-pwa/feedback.html">Feedback</a>
</nav>

<main>

<section class="section-box">
    <h2>Add New Roommate</h2>
    <p>Fill the information below:</p>
</section>

<section class="section-box">

    <input id="name" placeholder="Full Name">
    <input id="age" placeholder="Age">
    <input id="budget" placeholder="Monthly Budget">

    <textarea id="bio" placeholder="Short description"></textarea>

    <button id="saveBtn">Save</button>

</section>

</main>

<script type="module">
import { db, collection, addDoc, serverTimestamp } from "/safe-sphere-pwa/firebase.js";

// Fotos aleatorias
const randomPhotos = [
    "/safe-sphere-pwa/assets/roommates/p1.jpg",
    "/safe-sphere-pwa/assets/roommates/p2.jpg",
    "/safe-sphere-pwa/assets/roommates/p3.jpg",
    "/safe-sphere-pwa/assets/roommates/p4.jpg",
];

function randomPhoto() {
    return randomPhotos[Math.floor(Math.random() * randomPhotos.length)];
}

document.getElementById("saveBtn").addEventListener("click", async () => {

    const name = document.getElementById("name").value.trim();
    const age = document.getElementById("age").value.trim();
    const budget = document.getElementById("budget").value.trim();
    const bio = document.getElementById("bio").value.trim();

    if (!name || !age || !budget) {
        alert("Please complete all required fields.");
        return;
    }

    try {
        await addDoc(collection(db, "roommates"), {
            name,
            age,
            budget,
            bio,
            createdAt: serverTimestamp(),
            photo: randomPhoto() // <-- FOTO ALEATORIA
        });

        alert("Roommate added successfully!");
        window.location.href = "/safe-sphere-pwa/roommates.html";

    } catch (err) {
        console.error(err);
        alert("Error saving roommate.");
    }

});
</script>

</body>
</html>
