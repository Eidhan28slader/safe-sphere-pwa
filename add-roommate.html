<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Roommate</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<nav>
    <img src="assets/logo.png" class="logo">
    <a href="index.html">Home</a>
    <a href="listing.html">Listing</a>
    <a href="post.html">Post</a>
    <a href="admin.html">Admin</a>
    <a href="roommates.html">Roommates</a>
    <a href="feedback.html">Feedback</a>
</nav>

<main>

<section class="section-box">
    <h2>Add New Roommate</h2>
    <p>Fill the information below:</p>

    <input id="rm-name" placeholder="Full Name">
    <input id="rm-age" type="number" placeholder="Age">
    <input id="rm-budget" type="number" placeholder="Monthly Budget">
    <textarea id="rm-bio" placeholder="Short description"></textarea>

    <label>Upload Photo</label>
    <input id="rm-photo" type="file" accept="image/*">

    <button id="saveRoommate">Save</button>
</section>

</main>

<script type="module">
import {
    db,
    auth,
    collection,
    addDoc,
    serverTimestamp,
} from "./firebase.js";

import {
    getStorage,
    ref,
    uploadBytes,
    getDownloadURL
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

const saveBtn = document.getElementById("saveRoommate");
const storage = getStorage();

saveBtn.addEventListener("click", async () => {

    const name = document.getElementById("rm-name").value;
    const age = document.getElementById("rm-age").value;
    const budget = document.getElementById("rm-budget").value;
    const bio = document.getElementById("rm-bio").value;
    const file = document.getElementById("rm-photo").files[0];

    if (!name || !age || !budget || !bio) {
        alert("Please complete all fields.");
        return;
    }

    let photoURL = "assets/roommates/default.jpg";

    if (file) {
        const filePath = `roommates/${Date.now()}_${file.name}`;
        const fileRef = ref(storage, filePath);

        await uploadBytes(fileRef, file);
        photoURL = await getDownloadURL(fileRef);
    }

    await addDoc(collection(db, "roommates"), {
        name,
        age,
        budget,
        bio,
        photo: photoURL,
        createdAt: serverTimestamp(),
        userId: auth.currentUser ? auth.currentUser.uid : "anonymous"
    });

    alert("Roommate added!");
    window.location.href = "roommates.html";
});
</script>

</body>
</html>
