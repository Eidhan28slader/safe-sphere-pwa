<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SafeSphere - Admin</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<nav>
  <img src="/safe-sphere-pwa/assets/logo.png" class="logo" alt="SafeSphere logo">
  <a href="/safe-sphere-pwa/index.html">Home</a>
  <a href="/safe-sphere-pwa/listing.html">Listing</a>
  <a href="/safe-sphere-pwa/post.html">Post</a>
  <a href="/safe-sphere-pwa/admin.html">Admin</a>
  <a href="/safe-sphere-pwa/roommates.html">Roommates</a>
  <a href="/safe-sphere-pwa/feedback.html">Feedback</a>
</nav>


<section class="section-box">
    <h2>Admin Panel</h2>
    <p>Approve, reject or delete listings</p>
</section>

<section class="section-box">
    <h2>Publicaciones recibidas</h2>
    <div id="adminPosts">Loading...</div>
</section>

<script type="module">
import { db, collection, onSnapshot, query, orderBy, updateDoc, deleteDoc, doc } from "./firebase.js";

const box = document.getElementById("adminPosts");

onSnapshot(query(collection(db, "posts"), orderBy("createdAt", "desc")), snapshot => {
    box.innerHTML = "";

    snapshot.forEach(d => {
        const p = d.data();
        const id = d.id;

        box.innerHTML += `
        <div class="admin-item">
            <h3>${p.title}</h3>
            <p>${p.desc}</p>
            <p><b>Price:</b> $${p.price}</p>
            <p><b>Status:</b> ${p.status}</p>

            <button onclick="approve('${id}')">Approve</button>
            <button onclick="reject('${id}')">Reject</button>
            <button onclick="remove('${id}')">Delete</button>
        </div>`;
    });
});

// MAKE FUNCTIONS GLOBAL
window.approve = async (id) => {
    await updateDoc(doc(db, "posts", id), { status: "approved" });
};

window.reject = async (id) => {
    await updateDoc(doc(db, "posts", id), { status: "rejected" });
};

window.remove = async (id) => {
    if (confirm("Delete post?"))
        await deleteDoc(doc(db, "posts", id));
};
</script>

</body>
</html>

