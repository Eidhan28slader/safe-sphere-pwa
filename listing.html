<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SafeSphere - Listings</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>

<nav>
  <img src="assets/logo.png" class="logo" alt="SafeSphere logo">
  <a href="index.html">Home</a>
  <a href="listing.html">Listing</a>
  <a href="post.html">Post</a>
  <a href="admin.html">Admin</a>
  <a href="roommate.html">Roommates</a>
  <a href="feedback.html">Feedback</a>
</nav>

<main>

<section class="section-box">
  <h2>Available Listings</h2>
  <p>Approved posts appear here automatically.</p>
</section>

<section id="listings-container">
  <p>Loading...</p>
</section>

</main>


<script type="module">

  import { db, onSnapshot, collection, query, orderBy } 
    from "./firebase.js";

  const box = document.getElementById("listings-container");

  const houseImages = [
    "assets/houses/house1.jpg",
    "assets/houses/house2.jpg",
    "assets/houses/house3.jpg",
    "assets/houses/house4.jpg",
    "assets/houses/house5.jpg"
  ];

  function randomImage() {
    return houseImages[Math.floor(Math.random() * houseImages.length)];
  }

  onSnapshot(
    query(collection(db, "posts"), orderBy("createdAt", "desc")),
    snap => {

      box.innerHTML = "";

      snap.forEach(doc => {

        const p = doc.data();

        if (p.status !== "approved") return;

        const img = randomImage();
        box.innerHTML += `
  <div class="card">
    <img src="${img}" class="card-img">

    <h3>${p.title}</h3>
    <p>${p.desc}</p>
    <p><b>Price: $${p.price}</b></p>

    <div class="safety-box">
      <p><b>Security:</b> ${p.securityLevel ?? "Not specified"}</p>
      <p><b>PlusvalÃ­a:</b> ${p.plusvalia ?? "Not specified"}</p>
    </div>

    <div class="nearby-box">
      <h4>Nearby Places</h4>
      <div class="nearby-items">
        ${p.nearby?.miniMarket ? "<span>ğŸ›’ Mini Market</span>" : ""}
        ${p.nearby?.supermarket ? "<span>ğŸ¬ Supermarket</span>" : ""}
        ${p.nearby?.pharmacy ? "<span>ğŸ’Š Pharmacy</span>" : ""}
        ${p.nearby?.busStop ? "<span>ğŸšŒ Bus Stop</span>" : ""}
        ${p.nearby?.university ? "<span>ğŸ“ University</span>" : ""}
        ${p.nearby?.hospital ? "<span>ğŸ¥ Hospital</span>" : ""}
      </div>
    </div>

    <span class="badge verified">Approved</span>
  </div>
        `;    
      });
    }
  );

</script>

</body>
</html>
